

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Color thresholding semantic segmentation &mdash; HistomicsTK 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Finding cellular regions with superpixel analysis" href="histomicstk.saliency.cellularity_detection_superpixels.html" />
    <link rel="prev" title="Tissue Detection" href="histomicstk.saliency.tissue_detection.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> HistomicsTK
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api-docs.html">API Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="histomicstk.html">histomicstk</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="histomicstk.utils.html">utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.preprocessing.html">preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.filters.html">filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.segmentation.html">segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.features.html">features</a></li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.annotations_and_masks.html">annotations and masks</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="histomicstk.saliency.html">saliency (tissue/cellularity detection)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="histomicstk.saliency.tissue_detection.html">Tissue detection</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Cellularity detection (using thresholding)</a></li>
<li class="toctree-l4"><a class="reference internal" href="histomicstk.saliency.cellularity_detection_superpixels.html">Cellularity detection (using superpixels)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="histomicstk.workflows.html">workflows</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HistomicsTK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="api-docs.html">API Documentation</a> &raquo;</li>
        
          <li><a href="histomicstk.html">histomicstk</a> &raquo;</li>
        
          <li><a href="histomicstk.saliency.html">histomicstk.saliency</a> &raquo;</li>
        
      <li>Color thresholding semantic segmentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/histomicstk.saliency.cellularity_detection_thresholding.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-histomicstk.saliency.cellularity_detection_thresholding">
<span id="color-thresholding-semantic-segmentation"></span><h1>Color thresholding semantic segmentation<a class="headerlink" href="#module-histomicstk.saliency.cellularity_detection_thresholding" title="Permalink to this headline">¶</a></h1>
<p>Created on Tue Oct 22 02:37:52 2019.</p>
<p>&#64;author: mtageld</p>
<dl class="py class">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece">
<em class="property">class </em><code class="sig-prename descclassname">histomicstk.saliency.cellularity_detection_thresholding.</code><code class="sig-name descname">CDT_single_tissue_piece</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cdt</span></em>, <em class="sig-param"><span class="n">tissue_mask</span></em>, <em class="sig-param"><span class="n">monitorPrefix</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Detect various regions in a single tissue piece (internal).</p>
<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.assign_components_by_thresholding">
<code class="sig-name descname">assign_components_by_thresholding</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.assign_components_by_thresholding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.assign_components_by_thresholding" title="Permalink to this definition">¶</a></dt>
<dd><p>Get components by thresholding in HSI and LAB spaces.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.color_normalize_unspecified_components">
<code class="sig-name descname">color_normalize_unspecified_components</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.color_normalize_unspecified_components"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.color_normalize_unspecified_components" title="Permalink to this definition">¶</a></dt>
<dd><p>Color normalize “true” tissue components.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.find_potentially_cellular_regions">
<code class="sig-name descname">find_potentially_cellular_regions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.find_potentially_cellular_regions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.find_potentially_cellular_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Find regions that are potentially cellular.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.find_top_cellular_regions">
<code class="sig-name descname">find_top_cellular_regions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.find_top_cellular_regions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.find_top_cellular_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>Keep largest and most cellular regions.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.initialize_labeled_mask">
<code class="sig-name descname">initialize_labeled_mask</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.initialize_labeled_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.initialize_labeled_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize labeled components mask.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.restrict_mask_to_single_tissue_piece">
<code class="sig-name descname">restrict_mask_to_single_tissue_piece</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.restrict_mask_to_single_tissue_piece"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.restrict_mask_to_single_tissue_piece" title="Permalink to this definition">¶</a></dt>
<dd><p>Only keep relevant part of slide mask.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Get cellularity and optionally visualize on DSA.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.set_tissue_rgb">
<code class="sig-name descname">set_tissue_rgb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.set_tissue_rgb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.set_tissue_rgb" title="Permalink to this definition">¶</a></dt>
<dd><p>Load RGB from server for single tissue piece.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.visualize_results">
<code class="sig-name descname">visualize_results</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#CDT_single_tissue_piece.visualize_results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.CDT_single_tissue_piece.visualize_results" title="Permalink to this definition">¶</a></dt>
<dd><p>Visualize results in DSA.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding">
<em class="property">class </em><code class="sig-prename descclassname">histomicstk.saliency.cellularity_detection_thresholding.</code><code class="sig-name descname">Cellularity_detector_thresholding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">gc</span></em>, <em class="sig-param"><span class="n">slide_id</span></em>, <em class="sig-param"><span class="n">GTcodes</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#Cellularity_detector_thresholding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">histomicstk.utils.general_utils.Base_HTK_Class</span></code></p>
<p>Detect cellular regions in a slide using thresholding.</p>
<p>This uses a thresholding and stain unmixing based pipeline
to detect highly-cellular regions in a slide. The run()
method of the CDT_single_tissue_piece() class has the key
steps of the pipeline. In summary, here are the steps
involved…</p>
<p>1. Detect tissue from background using the RGB slide
thumbnail. Each “tissue piece” is analysed independently
from here onwards. The tissue_detection modeule is used
for this step. A high sensitivity, low specificity setting
is used here.</p>
<p>2. Fetch the RGB image of tissue at target magnification. A
low magnification (default is 3.0) is used and is sufficient.</p>
<p>3. The image is converted to HSI and LAB spaces. Thresholding
is performed to detect various non-salient components that
often throw-off the color normalization and deconvolution
algorithms. Thresholding includes both minimum and maximum
values. The user can set whichever thresholds of components
they would like. The development of this workflow was focused
on breast cancer so the thresholded components by default
are whote space (or adipose tissue), dark blue/green blotches
(sharpie, inking at margin, etc), and blood. Whitespace
is obtained by thresholding the saturation and intensity,
while other components are obtained by thresholding LAB.</p>
<p>4. Now that we know where “actual” tissue is, we do a MASKED
color normalization to a prespecified standard. The masking
ensures the normalization routine is not thrown off by non-
tissue components.</p>
<p>5. Perform masked stain unmixing/deconvolution to obtain the
hematoxylin stain channel.</p>
<p>6. Smooth and threshold the hematoxylin channel. Then
perform connected component analysis to find contiguous
potentially-cellular regions.</p>
<p>7. Keep the n largest potentially-cellular regions. Then
from those large regions, keep the m brightest regions
(using hematoxylin channel brightness) as the final
salient/cellular regions.</p>
<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.fix_GTcodes">
<code class="sig-name descname">fix_GTcodes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#Cellularity_detector_thresholding.fix_GTcodes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.fix_GTcodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix self.GTcodes (important!).</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#Cellularity_detector_thresholding.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run full pipeline to detect cellular regions.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.set_color_normalization_target">
<code class="sig-name descname">set_color_normalization_target</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ref_image_path</span></em>, <em class="sig-param"><span class="n">color_normalization_method</span><span class="o">=</span><span class="default_value">'macenko_pca'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#Cellularity_detector_thresholding.set_color_normalization_target"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.set_color_normalization_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Set color normalization values to use from target image.</p>
<p>Arguments
ref_image_path, str
&gt;    path to target (reference) image
color_normalization_method, str
&gt;    color normalization method to use. Currently, only
&gt;    reinhard and macenko_pca are accepted.</p>
</dd></dl>

<dl class="py method">
<dt id="histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.set_slide_info_and_get_tissue_mask">
<code class="sig-name descname">set_slide_info_and_get_tissue_mask</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/histomicstk/saliency/cellularity_detection_thresholding.html#Cellularity_detector_thresholding.set_slide_info_and_get_tissue_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#histomicstk.saliency.cellularity_detection_thresholding.Cellularity_detector_thresholding.set_slide_info_and_get_tissue_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Set self.slide_info dict and self.labeled tissue mask.</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="histomicstk.saliency.cellularity_detection_superpixels.html" class="btn btn-neutral float-right" title="Finding cellular regions with superpixel analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="histomicstk.saliency.tissue_detection.html" class="btn btn-neutral float-left" title="Tissue Detection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Kitware, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>